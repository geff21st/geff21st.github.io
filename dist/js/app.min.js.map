{"version":3,"sources":["app.js"],"names":["ksort","obj","keys","Object","sort","sortedObj","i","loadPictures","pdfDoc","pdfSrc","window","loaded","arrSrc","PDFJS","workerSrc","getDocument","then","pdfDoc_","console","log","numPages","addCanvasPage","appendPictures","maxW","maxH","magazine","document","querySelector","$","each","value","img","createElement","setAttribute","src","double","img_clone","cloneNode","appendChild","h","height","w","Math","floor","setTimeout","loadApp","num","max","canvas","ctx","getContext","getPage","page","scale","viewport","getViewport","width","task","render","canvasContext","promise","toDataURL","percent","parent","text"],"mappings":"AAAA,QAASA,OAAMC,GACX,GAAIC,GAAOC,OAAOD,KAAKD,GAAKG,OACtBC,IAEN,KAAK,GAAIC,KAAKJ,GACVG,EAAUH,EAAKI,IAAML,EAAIC,EAAKI,GAGlC,OAAOD,GAGX,GAAIE,cAAe,WAEf,GACIC,GADAC,EAAS,cAIbC,QAAOC,OAAS,EAChBD,OAAOE,UAGPC,MAAMC,UAAY,iDAElBD,MAAME,YAAYN,GAAQO,KAAK,SAAUC,GACrCT,EAASS,EAETC,QAAQC,IAAIX,EAKZ,KAAK,GAHDY,GAAWZ,EAAOY,SAGbd,EAAI,EAAGA,GAAKc,EAAUd,IAC3Be,EAAcf,EAAGc,IAKzB,IAAIE,GAAiB,SAAUC,EAAMC,GACjCxB,MAAMY,OAEN,IAAIa,GAAWC,SAASC,cAAc,OAEtCC,GAAEC,KAAKjB,OAAQ,SAAUN,EAAGwB,GAExB,GAAIC,GAAML,SAASM,cAAc,MAIjC,IAHAD,EAAIE,aAAa,YAAa3B,GAC9ByB,EAAIE,aAAa,QAAS,yBAA2BH,EAAMI,IAAM,KAE9DJ,EAAMK,OAAQ,CACb,GAAIC,GAAYL,EAAIM,WAAU,EAC9BD,GAAUH,aAAa,QAAS,sBAChCR,EAASa,YAAYF,GAErBL,EAAIE,aAAa,QAAS,uBAG9BR,EAASa,YAAYP,GAElBD,EAAMK,QACLjB,QAAQC,IAAI,QAIpB,IAAIoB,GAAIX,EAAElB,QAAQ8B,SAAW,GACzBC,EAAIC,KAAKC,MAAMpB,EAAOgB,EAAIf,EAE9BN,SAAQC,IAAIsB,EAAGF,GAEfK,WAAW,WAEPC,QAAQJ,EAAGF,IAEZ,MAGHlB,EAAgB,SAAUyB,EAAKC,GAE/B,GAAIC,GAAStB,SAASM,cAAc,UAChCiB,EAAMD,EAAOE,WAAW,MAExB3B,EAAO,EACPC,EAAO,CAEXhB,GAAO2C,QAAQL,GAAK9B,KAAK,SAAUoC,GAC/B,GAAIC,GAAQ,EACRC,EAAWF,EAAKG,YAAYF,EAIhCL,GAAOR,OAASc,EAASd,OACzBQ,EAAOQ,MAAQF,EAASE,KAIxB,IAAIC,GAAOL,EAAKM,QAAQC,cAAeV,EAAKK,SAAUA,GACtDG,GAAKG,QAAQ5C,KAAK,WAEXsC,EAASE,MAAQjC,IAChBA,EAAO+B,EAASE,OAGjBF,EAASd,OAAShB,IACjBA,EAAO8B,EAASd,QAGpB5B,OAAOkC,IACHX,OAAQmB,EAASE,MAAQF,EAASd,OAClCN,IAAKc,EAAOa,UAAU,eAG1BlD,QAEA,IAAImD,GAAUpB,KAAKC,MAAM,OAAWI,EAAM,IACvCgB,QAAS,KACZnC,EAAE,aAAaoC,KAAKF,EAAU,KAAKN,MAAMM,EAAU,KAG/CnD,SAAWoC,GACXzB,EAAeC,EAAMC","file":"app.min.js","sourcesContent":["function ksort(obj) {\r\n    var keys = Object.keys(obj).sort()\r\n        , sortedObj = {};\r\n\r\n    for (var i in keys) {\r\n        sortedObj[keys[i]] = obj[keys[i]];\r\n    }\r\n\r\n    return sortedObj;\r\n}\r\n\r\nvar loadPictures = function () {\r\n\r\n    var pdfSrc = '/testmag.pdf';\r\n    var pdfDoc;\r\n    var scale = 1.5;\r\n\r\n    window.loaded = 0;\r\n    window.arrSrc = {};\r\n\r\n    // PDFJS.disableWorker = true;\r\n    PDFJS.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';\r\n\r\n    PDFJS.getDocument(pdfSrc).then(function (pdfDoc_) {\r\n        pdfDoc = pdfDoc_;\r\n\r\n        console.log(pdfDoc)\r\n\r\n        var numPages = pdfDoc.numPages;\r\n        // var numPages = 4;\r\n\r\n        for (var i = 1; i <= numPages; i++) {\r\n            addCanvasPage(i, numPages);\r\n        }\r\n\r\n    });\r\n\r\n    var appendPictures = function (maxW, maxH) {\r\n        ksort(arrSrc);\r\n\r\n        var magazine = document.querySelector('.pdf');\r\n\r\n        $.each(arrSrc, function (i, value) {\r\n\r\n            var img = document.createElement('div');\r\n            img.setAttribute('data-page', i);\r\n            img.setAttribute('style', 'background-image: url(' + value.src + ')');\r\n\r\n            if(value.double) {\r\n                var img_clone = img.cloneNode(true);\r\n                img_clone.setAttribute('class', 'double double-left');\r\n                magazine.appendChild(img_clone);\r\n\r\n                img.setAttribute('class', 'double double-right');\r\n            }\r\n\r\n            magazine.appendChild(img);\r\n\r\n            if(value.double) {\r\n                console.log('cut');\r\n            }\r\n        });\r\n\r\n        var h = $(window).height() - 40;\r\n        var w = Math.floor(maxW * h / maxH);\r\n\r\n        console.log(w, h);\r\n\r\n        setTimeout(function () {\r\n            // $('.magazine .double').scissor();\r\n            loadApp(w, h);\r\n            // $('#canvas').show();\r\n        }, 1000);\r\n    };\r\n\r\n    var addCanvasPage = function (num, max) {\r\n\r\n        var canvas = document.createElement('canvas');\r\n        var ctx = canvas.getContext('2d');\r\n\r\n        var maxW = 0;\r\n        var maxH = 0;\r\n\r\n        pdfDoc.getPage(num).then(function (page) {\r\n            var scale = 1;\r\n            var viewport = page.getViewport(scale);\r\n            //\r\n            // Prepare canvas using PDF page dimensions\r\n            //\r\n            canvas.height = viewport.height;\r\n            canvas.width = viewport.width;\r\n            //\r\n            // Render PDF page into canvas context\r\n            //\r\n            var task = page.render({canvasContext: ctx, viewport: viewport})\r\n            task.promise.then(function () {\r\n\r\n                if(viewport.width > maxW) {\r\n                    maxW = viewport.width;\r\n                }\r\n\r\n                if(viewport.height > maxH) {\r\n                    maxH = viewport.height;\r\n                }\r\n\r\n                arrSrc[num] = {\r\n                    double: viewport.width > viewport.height,\r\n                    src: canvas.toDataURL('image/jpeg'),\r\n                };\r\n\r\n                loaded++;\r\n\r\n                var percent = Math.floor((loaded) / max * 100);\r\n                if(parent > 50) return;\r\n                $('.progress').text(percent + '%').width(percent + '%');\r\n\r\n\r\n                if (loaded === max) {\r\n                    appendPictures(maxW, maxH);\r\n                }\r\n            });\r\n        });\r\n\r\n    };\r\n\r\n};\r\n\r\n"]}